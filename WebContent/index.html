<!DOCTYPE html>
<html>
<head>
	<title>Registration Form</title>
	<!-- Custom CSS -->
	<link rel="stylesheet" type="text/css" href="index.css">
	<!-- jQuery -->
	<script
	  src="https://code.jquery.com/jquery-3.3.1.js"
	  integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
	  crossorigin="anonymous"></script>
	<!-- Bootstrap CDN-->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
	<!-- Handlebars -->
	<script type="text/javascript" src="handlebars-v4.0.12.js"></script>
	<!-- Form handlebar -->
	<script type="text/javascript" src="form.js"></script>
</head>
<body>
	<div id="heading"></div>
	<!-- <script id="the-template" type="text/x-handlebars-template"> -->
		
	<!-- </script> -->
	<script type="text/javascript">
		// Registering the template
		// var templateInfo = document.getElementById("the-template").innerHTML;
		// var template = Handlebars.compile(templateInfo);
		
		var template = Handlebars.templates['form'];

		// Partial Helper for Heading

		Handlebars.registerPartial("heading", '<{{tagName}} class = "{{className}}">{{heading}}</{{tagName}}>');
		var headingInfo = template({
			heading: "Example Form using Handlebar JS",
			className: "top-margin-1 bold-text center-text"
		});
		document.getElementById("heading").innerHTML += headingInfo;

		// Helper for Form
		var personInfo = template({
			name: {
				tagId: "user-name",
				tagName: "Name",
				tagPlaceHolder: "Enter your name",
				tagType: "text"
			},
			email: {
				tagId: "user-email",
				tagName: "E-Mail",
				tagPlaceHolder: "Enter your E-Mail ID",
				tagType: "text"
			},
			gender: {
				tagId: "user-gender",
				tagName: "Gender",
				tagClass: "form-check-inline",
				tagType: "radio",
				tagChoices: [
					{choice: "Male",subtagClass: "active"},
					{choice: "Female", subtagClass: ""},
					{choice: "Other", subtagClass: ""}
				]
			},
			password: {
				tagId: "user-password",
				tagName: "Password",
				tagType: "password",
				tagPlaceHolder: "Enter your password"
			},
			confirmPassword: {
				tagId: "confirm-password",
				tagName: "Confirm Password",
				tagType: "password",
				tagPlaceHolder: "Confirm your password"
			},
			buttons: [
				{choice: "Submit", buttonType: "button", tagClass: "btn btn-success", buttonFunction: "return submitForm()"},
				{choice: "Reset", buttonType: "reset", tagClass: "btn btn-danger", buttonFunction: "resetForm()"}
			]
		});
		document.getElementById("user-form").innerHTML += personInfo;
		
		// Error Function

		function resetForm(e) {
			document.getElementById("form-errors").value = "";	
			document.getElementById("user-name").value = "";
			document.getElementById("user-email").value = "";
			document.getElementById("user-password").value = "";
			document.getElementById("confirm-password").value = "";
		}

		function submitForm() {
			let userName = document.getElementById("user-name").value;
			let userEmail = document.getElementById("user-email").value;
			let userPassword = document.getElementById("user-password").value;
			let userConfirmPassword = document.getElementById("confirm-password").value;
			let formText = "";
			// Check for emptiness of the fields
			if(userName == "" || userEmail == "" || userPassword == "" || userConfirmPassword == "") {
				formText = "<span class='red-text'>No field should be empty!</span>";
			}

			// Check for E-mail using Regex

			else if(!(/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/).test(String(userEmail).toLowerCase())) {
				formText = "<span class='red-text'>E-mail format does not match!</span>";
			}

			//Check for Password equality

			else if(String(userPassword) != String(userConfirmPassword)) {
				formText = "<span class='red-text'>Password does not match!</span>";
			}

			// Success
			else {
				var userDetails = {};
				userDetails["userName"] = userName;
				userDetails["userEmail"] = userEmail;
				userDetails["userPassword"] = userPassword;
				$.ajax({
				    type: "POST",
				    url: "/UserForm/FormServlet",
				    data: JSON.stringify(userDetails),
				    contentType: "application/json",
				    dataType: "json",
				    success: function(result){
				        alert(result);
				    },
				    error: function(result) {
				    	alert(result["responseText"]);
				    }
				});
				return false;
			}
			document.getElementById("form-errors").innerHTML = formText;
			return false;
		}
	</script>
</body>
</html>